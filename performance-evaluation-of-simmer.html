<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Energy Efficiency in Wireless Communications for Mobile User Devices</title>
  <meta name="description" content="<p>Tesis doctoral. Universidad Carlos III de Madrid. Departamento de Ingeniería Telemática.</p>">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Energy Efficiency in Wireless Communications for Mobile User Devices" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/cover-front.png" />
  <meta property="og:description" content="<p>Tesis doctoral. Universidad Carlos III de Madrid. Departamento de Ingeniería Telemática.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Energy Efficiency in Wireless Communications for Mobile User Devices" />
  
  <meta name="twitter:description" content="<p>Tesis doctoral. Universidad Carlos III de Madrid. Departamento de Ingeniería Telemática.</p>" />
  <meta name="twitter:image" content="img/cover-front.png" />

<meta name="author" content="Iñaki Úcar">


<meta name="date" content="2018-07-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="experimental-validation-of-ra-tpc-inefficiencies.html">
<link rel="next" href="references.html">
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#cross-factor-towards-a-new-energy-model"><i class="fa fa-check"></i><b>1.1</b> Cross-Factor: Towards a New Energy Model</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#micro-sleep-opportunities-in-802.11"><i class="fa fa-check"></i><b>1.2</b> Micro-Sleep Opportunities in 802.11</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#rate-adaptation-and-power-control-in-802.11"><i class="fa fa-check"></i><b>1.3</b> Rate Adaptation and Power Control in 802.11</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#applied-simulation-modelling-for-energy-efficiency"><i class="fa fa-check"></i><b>1.4</b> Applied Simulation Modelling for Energy Efficiency</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#thesis-overview"><i class="fa fa-check"></i><b>1.5</b> Thesis Overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-02.html"><a href="ch-02.html"><i class="fa fa-check"></i><b>2</b> Related Work</a><ul>
<li class="chapter" data-level="2.1" data-path="ch-02.html"><a href="ch-02.html#energy-profiling-for-wireless-communications"><i class="fa fa-check"></i><b>2.1</b> Energy Profiling for Wireless Communications</a></li>
<li class="chapter" data-level="2.2" data-path="ch-02.html"><a href="ch-02.html#energy-consumption-of-network-stacks"><i class="fa fa-check"></i><b>2.2</b> Energy Consumption of Network Stacks</a></li>
<li class="chapter" data-level="2.3" data-path="ch-02.html"><a href="ch-02.html#micro-sleep-opportunities-in-802.11-1"><i class="fa fa-check"></i><b>2.3</b> Micro-Sleep Opportunities in 802.11</a></li>
<li class="chapter" data-level="2.4" data-path="ch-02.html"><a href="ch-02.html#rate-adaptation-and-power-control-in-802.11-1"><i class="fa fa-check"></i><b>2.4</b> Rate Adaptation and Power Control in 802.11</a></li>
<li class="chapter" data-level="2.5" data-path="ch-02.html"><a href="ch-02.html#discrete-event-simulation-of-network-systems"><i class="fa fa-check"></i><b>2.5</b> Discrete-Event Simulation of Network Systems</a></li>
</ul></li>
<li class="part"><span><b>I Experimentation</b></span></li>
<li class="chapter" data-level="3" data-path="ch-03.html"><a href="ch-03.html"><i class="fa fa-check"></i><b>3</b> A Comprehensive Energy Measurement Framework</a><ul>
<li class="chapter" data-level="3.1" data-path="ch-03.html"><a href="ch-03.html#instrumentation"><i class="fa fa-check"></i><b>3.1</b> Instrumentation</a></li>
<li class="chapter" data-level="3.2" data-path="ch-03.html"><a href="ch-03.html#measurement-and-uncertainty-analysis"><i class="fa fa-check"></i><b>3.2</b> Measurement and Uncertainty Analysis</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ch-03.html"><a href="ch-03.html#propagation-of-uncertainty"><i class="fa fa-check"></i><b>3.2.1</b> Propagation of Uncertainty</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-03.html"><a href="ch-03.html#reporting-uncertainty"><i class="fa fa-check"></i><b>3.2.2</b> Reporting Uncertainty</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-03.html"><a href="ch-03.html#automated-uncertainty-handling-in-r-the-errors-package"><i class="fa fa-check"></i><b>3.2.3</b> Automated Uncertainty Handling in R: The <code>errors</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-03.html"><a href="ch-03.html#whole-device-measurements"><i class="fa fa-check"></i><b>3.3</b> Whole-Device Measurements</a><ul>
<li class="chapter" data-level="3.3.1" data-path="ch-03.html"><a href="ch-03.html#validation"><i class="fa fa-check"></i><b>3.3.1</b> Validation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="ch-03.html"><a href="ch-03.html#per-component-measurements"><i class="fa fa-check"></i><b>3.4</b> Per-Component Measurements</a><ul>
<li class="chapter" data-level="3.4.1" data-path="ch-03.html"><a href="ch-03.html#characterisation-of-a-cots-device"><i class="fa fa-check"></i><b>3.4.1</b> Characterisation of a COTS Device</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="ch-03.html"><a href="ch-03.html#summary"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-04.html"><a href="ch-04.html"><i class="fa fa-check"></i><b>4</b> Deseeding Energy Consumption of Network Stacks</a><ul>
<li class="chapter" data-level="4.1" data-path="ch-04.html"><a href="ch-04.html#anatomy-of-a-laptop-computer"><i class="fa fa-check"></i><b>4.1</b> Anatomy of a Laptop Computer</a></li>
<li class="chapter" data-level="4.2" data-path="ch-04.html"><a href="ch-04.html#cross-factor-separating-the-wheat-from-the-chaff"><i class="fa fa-check"></i><b>4.2</b> Cross-Factor: Separating the Wheat from the Chaff</a></li>
<li class="chapter" data-level="4.3" data-path="ch-04.html"><a href="ch-04.html#power-consumption-in-unattended-idle-mode"><i class="fa fa-check"></i><b>4.3</b> Power Consumption in Unattended Idle Mode</a></li>
<li class="chapter" data-level="4.4" data-path="ch-04.html"><a href="ch-04.html#power-consumption-with-full-cpuidle-subsystem"><i class="fa fa-check"></i><b>4.4</b> Power Consumption with Full <code>cpuidle</code> Subsystem</a></li>
<li class="chapter" data-level="4.5" data-path="ch-04.html"><a href="ch-04.html#exploring-the-cpuidle-subsystem"><i class="fa fa-check"></i><b>4.5</b> Exploring the <code>cpuidle</code> Subsystem</a></li>
<li class="chapter" data-level="4.6" data-path="ch-04.html"><a href="ch-04.html#summary-1"><i class="fa fa-check"></i><b>4.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch-05.html"><a href="ch-05.html"><i class="fa fa-check"></i><b>5</b> Leveraging Micro-Sleep Opportunities in 802.11</a><ul>
<li class="chapter" data-level="5.1" data-path="ch-05.html"><a href="ch-05.html#state-transition-times"><i class="fa fa-check"></i><b>5.1</b> State Transition Times in 802.11 Cards</a></li>
<li class="chapter" data-level="5.2" data-path="ch-05.html"><a href="ch-05.html#protocol-analysis-and-practical-issues"><i class="fa fa-check"></i><b>5.2</b> Protocol Analysis and Practical Issues</a><ul>
<li class="chapter" data-level="5.2.1" data-path="ch-05.html"><a href="ch-05.html#identifying-potential-micro-sleep-opportunities"><i class="fa fa-check"></i><b>5.2.1</b> Identifying Potential Micro-Sleep Opportunities</a></li>
<li class="chapter" data-level="5.2.2" data-path="ch-05.html"><a href="ch-05.html#impact-of-capture-effect"><i class="fa fa-check"></i><b>5.2.2</b> Impact of Capture Effect</a></li>
<li class="chapter" data-level="5.2.3" data-path="ch-05.html"><a href="ch-05.html#impact-of-errors-in-the-mac-header"><i class="fa fa-check"></i><b>5.2.3</b> Impact of Errors in the MAC Header</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="ch-05.html"><a href="ch-05.html#munap-algorithm"><i class="fa fa-check"></i><b>5.3</b> <span class="math inline">\(\mu\)</span>Nap Algorithm</a></li>
<li class="chapter" data-level="5.4" data-path="ch-05.html"><a href="ch-05.html#performance-evaluation"><i class="fa fa-check"></i><b>5.4</b> Performance Evaluation</a><ul>
<li class="chapter" data-level="5.4.1" data-path="ch-05.html"><a href="ch-05.html#evaluation-with-real-traces"><i class="fa fa-check"></i><b>5.4.1</b> Evaluation with Real Traces</a></li>
<li class="chapter" data-level="5.4.2" data-path="ch-05.html"><a href="ch-05.html#impact-of-timing-constraints"><i class="fa fa-check"></i><b>5.4.2</b> Impact of Timing Constraints</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="ch-05.html"><a href="ch-05.html#summary-2"><i class="fa fa-check"></i><b>5.5</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>II Mathematical Modelling</b></span></li>
<li class="chapter" data-level="6" data-path="ch-06.html"><a href="ch-06.html"><i class="fa fa-check"></i><b>6</b> Rate Adaptation and Power Control in 802.11</a><ul>
<li class="chapter" data-level="6.1" data-path="ch-06.html"><a href="ch-06.html#joint-goodput-energy-model"><i class="fa fa-check"></i><b>6.1</b> Joint Goodput-Energy Model</a></li>
<li class="chapter" data-level="6.2" data-path="ch-06.html"><a href="ch-06.html#numerical-results"><i class="fa fa-check"></i><b>6.2</b> Numerical Results</a><ul>
<li class="chapter" data-level="6.2.1" data-path="ch-06.html"><a href="ch-06.html#optimal-goodput"><i class="fa fa-check"></i><b>6.2.1</b> Optimal Goodput</a></li>
<li class="chapter" data-level="6.2.2" data-path="ch-06.html"><a href="ch-06.html#extension-of-the-energy-parametrisation"><i class="fa fa-check"></i><b>6.2.2</b> Extension of the Energy Parametrisation</a></li>
<li class="chapter" data-level="6.2.3" data-path="ch-06.html"><a href="ch-06.html#energy-consumption"><i class="fa fa-check"></i><b>6.2.3</b> Energy Consumption</a></li>
<li class="chapter" data-level="6.2.4" data-path="ch-06.html"><a href="ch-06.html#energy-efficiency-vs.optimal-goodput"><i class="fa fa-check"></i><b>6.2.4</b> Energy Efficiency vs. Optimal Goodput</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ch-06.html"><a href="ch-06.html#discussion"><i class="fa fa-check"></i><b>6.3</b> Discussion</a><ul>
<li class="chapter" data-level="6.3.1" data-path="ch-06.html"><a href="ch-06.html#sensitivity-to-energy-parameter-scaling"><i class="fa fa-check"></i><b>6.3.1</b> Sensitivity to Energy Parameter Scaling</a></li>
<li class="chapter" data-level="6.3.2" data-path="ch-06.html"><a href="ch-06.html#heuristics-for-ra-tpc-algorithms"><i class="fa fa-check"></i><b>6.3.2</b> Heuristics for RA-TPC Algorithms</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="ch-06.html"><a href="ch-06.html#summary-3"><i class="fa fa-check"></i><b>6.4</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>III Simulation</b></span></li>
<li class="chapter" data-level="7" data-path="ch-07.html"><a href="ch-07.html"><i class="fa fa-check"></i><b>7</b> Performance of RA-TPC Algorithms in 802.11</a><ul>
<li class="chapter" data-level="7.1" data-path="ch-07.html"><a href="ch-07.html#algorithms-considered"><i class="fa fa-check"></i><b>7.1</b> Algorithms Considered</a></li>
<li class="chapter" data-level="7.2" data-path="ch-07.html"><a href="ch-07.html#simulation-scenario"><i class="fa fa-check"></i><b>7.2</b> Simulation Scenario</a></li>
<li class="chapter" data-level="7.3" data-path="ch-07.html"><a href="ch-07.html#results-and-discussion"><i class="fa fa-check"></i><b>7.3</b> Results and Discussion</a></li>
<li class="chapter" data-level="7.4" data-path="ch-07.html"><a href="ch-07.html#conservativeness-at-mode-transitions"><i class="fa fa-check"></i><b>7.4</b> Conservativeness at Mode Transitions</a></li>
<li class="chapter" data-level="7.5" data-path="ch-07.html"><a href="ch-07.html#summary-4"><i class="fa fa-check"></i><b>7.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ch-08.html"><a href="ch-08.html"><i class="fa fa-check"></i><b>8</b> A Novel Discrete-Event Simulation Framework</a><ul>
<li class="chapter" data-level="8.1" data-path="ch-08.html"><a href="ch-08.html#the-simulation-core-design"><i class="fa fa-check"></i><b>8.1</b> The Simulation Core Design</a><ul>
<li class="chapter" data-level="8.1.1" data-path="ch-08.html"><a href="ch-08.html#terminology"><i class="fa fa-check"></i><b>8.1.1</b> Terminology</a></li>
<li class="chapter" data-level="8.1.2" data-path="ch-08.html"><a href="ch-08.html#architecture"><i class="fa fa-check"></i><b>8.1.2</b> Architecture</a></li>
<li class="chapter" data-level="8.1.3" data-path="ch-08.html"><a href="ch-08.html#the-event-queue"><i class="fa fa-check"></i><b>8.1.3</b> The Event Queue</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="ch-08.html"><a href="ch-08.html#a-brief-introduction-to-simmer"><i class="fa fa-check"></i><b>8.2</b> A Brief Introduction to <code>simmer</code></a></li>
<li class="chapter" data-level="8.3" data-path="ch-08.html"><a href="ch-08.html#use-case-energy-efficiency-for-massive-iot"><i class="fa fa-check"></i><b>8.3</b> Use case: Energy Efficiency for Massive IoT</a></li>
<li class="chapter" data-level="8.4" data-path="ch-08.html"><a href="ch-08.html#summary-5"><i class="fa fa-check"></i><b>8.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ch-09.html"><a href="ch-09.html"><i class="fa fa-check"></i><b>9</b> Conclusions and Future Work</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="measurement-circuitry-schematics.html"><a href="measurement-circuitry-schematics.html"><i class="fa fa-check"></i><b>A</b> Measurement Circuitry Schematics</a></li>
<li class="chapter" data-level="B" data-path="experimental-validation-of-ra-tpc-inefficiencies.html"><a href="experimental-validation-of-ra-tpc-inefficiencies.html"><i class="fa fa-check"></i><b>B</b> Experimental Validation of RA-TPC Inefficiencies</a><ul>
<li class="chapter" data-level="B.1" data-path="experimental-validation-of-ra-tpc-inefficiencies.html"><a href="experimental-validation-of-ra-tpc-inefficiencies.html#experimental-setup"><i class="fa fa-check"></i><b>B.1</b> Experimental Setup</a></li>
<li class="chapter" data-level="B.2" data-path="experimental-validation-of-ra-tpc-inefficiencies.html"><a href="experimental-validation-of-ra-tpc-inefficiencies.html#methodology-and-results"><i class="fa fa-check"></i><b>B.2</b> Methodology and Results</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="performance-evaluation-of-simmer.html"><a href="performance-evaluation-of-simmer.html"><i class="fa fa-check"></i><b>C</b> Performance Evaluation of <code>simmer</code></a><ul>
<li class="chapter" data-level="C.1" data-path="performance-evaluation-of-simmer.html"><a href="performance-evaluation-of-simmer.html#comparison-with-similar-frameworks"><i class="fa fa-check"></i><b>C.1</b> Comparison with Similar Frameworks</a></li>
<li class="chapter" data-level="C.2" data-path="performance-evaluation-of-simmer.html"><a href="performance-evaluation-of-simmer.html#the-cost-of-calling-r-from-c"><i class="fa fa-check"></i><b>C.2</b> The Cost of Calling R from C++</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">
Licensed under <img alt="Creative Commons License" style="border-width:0;vertical-align:bottom" 
src="https://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png" /></a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Energy Efficiency in Wireless Communications for Mobile User Devices</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="performance-evaluation-of-simmer" class="section level1">
<h1><span class="header-section-number">C</span> Performance Evaluation of <code>simmer</code></h1>
<p><span class="newthought">This appendix</span> investigates the performance of <code>simmer</code> with the aim of assessing its usability as a general-purpose DES framework. A first section is devoted to measuring the simulation time of a simple model relative to <code>SimPy</code> <span class="citation">(Team SimPy <a href="#ref-SimPy">2017</a>)</span> and <code>SimJulia</code> <span class="citation">(Lauwens <a href="#ref-GitHub:SimJulia">2017</a>)</span>. The reader may find interesting to compare the expressiveness of each framework. Last but not least, the final section explores the cost of calling R from C++, revealing the existent trade-off, inherent to the design of this package, between performance and model complexity.</p>
<p>All the subsequent tests were performed under Fedora Linux 25 running on an Intel Core2 Quad CPU Q8400, with R 3.3.3, Python 2.7.13, <code>SimPy</code> 3.0.9, Julia 0.5.1 and <code>SimJulia</code> 0.3.14 from the default repositories. Absolute execution times presented here are specific to this platform and configuration, and thus they should not be taken as representative for any other system. Instead, the relative performance should be approximately constant across different systems.</p>
<div id="comparison-with-similar-frameworks" class="section level2">
<h2><span class="header-section-number">C.1</span> Comparison with Similar Frameworks</h2>
<p>A significant effort has been put into the design of <code>simmer</code> in order to make it performant enough to run general and relatively large simulation models in a reasonable amount of time. In this regard, a relevant comparison can be made against other general-purpose DES frameworks such as <code>SimPy</code> and <code>SimJulia</code>. To this effect, we simulate a simple M/M/1 queueing system as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;simmer&quot;</span>)

test_mm1_simmer &lt;-<span class="st"> </span><span class="cf">function</span>(n, m, <span class="dt">mon=</span><span class="ot">FALSE</span>) {
  mm1 &lt;-<span class="st"> </span><span class="kw">trajectory</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">seize</span>(<span class="st">&quot;server&quot;</span>, <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">timeout</span>(<span class="cf">function</span>() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">release</span>(<span class="st">&quot;server&quot;</span>, <span class="dv">1</span>)

  env &lt;-<span class="st"> </span><span class="kw">simmer</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add_resource</span>(<span class="st">&quot;server&quot;</span>, <span class="dv">1</span>, <span class="dt">mon=</span>mon) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add_generator</span>(<span class="st">&quot;customer&quot;</span>, mm1, <span class="cf">function</span>() <span class="kw">rexp</span>(m, <span class="dv">1</span>), <span class="dt">mon=</span>mon) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">run</span>(<span class="dt">until=</span>n)
}</code></pre></div>
<p>With the selected arrival rate, <span class="math inline">\(\lambda=1\)</span>, this test simulates an average of <code>n</code> arrivals entering a nearly saturated system (<span class="math inline">\(\rho=1/1.1\)</span>). Given that <code>simmer</code> generators are able to create arrivals in batches (i.e., more than one arrival for each function call) for improved performance, the parameter <code>m</code> controls the size of the batch. Finally, the <code>mon</code> flag enables or disables monitoring.</p>
<p>Let us build now the equivalent model using <code>SimPy</code>, with base Python for random number generation. We prepare the Python benchmark from R using the <code>rPython</code> package <span class="citation">(Bellosta <a href="#ref-CRAN:rPython">2015</a>)</span> as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rPython<span class="op">::</span><span class="kw">python.exec</span>(<span class="st">&quot;</span>
<span class="st">import simpy, random, time</span>

<span class="st">def test_mm1(n):</span>
<span class="st">  def exp_source(env, lambd, server, mu):</span>
<span class="st">      while True:</span>
<span class="st">          dt = random.expovariate(lambd)</span>
<span class="st">          yield env.timeout(dt)</span>
<span class="st">          env.process(customer(env, server, mu))</span>

<span class="st">  def customer(env, server, mu):</span>
<span class="st">      with server.request() as req:</span>
<span class="st">          yield req</span>
<span class="st">          dt = random.expovariate(mu)</span>
<span class="st">          yield env.timeout(dt)</span>

<span class="st">  env = simpy.Environment()</span>
<span class="st">  server = simpy.Resource(env, capacity=1)</span>
<span class="st">  env.process(exp_source(env, 1, server, 1.1))</span>
<span class="st">  env.run(until=n)</span>

<span class="st">def benchmark(n, times):</span>
<span class="st">  results = []</span>
<span class="st">  for i in range(0, times):</span>
<span class="st">    start = time.time()</span>
<span class="st">    test_mm1(n)</span>
<span class="st">    results.append(time.time() - start)</span>
<span class="st">  return results</span>
<span class="st">&quot;</span>)</code></pre></div>
<p>Equivalently, this can be done for <code>SimJulia</code> using the <code>rjulia</code> package <span class="citation">(Gong, Keys, and Maechler <a href="#ref-GitHub:rJulia">2017</a>)</span>. Once more, <code>n</code> controls the average number of arrivals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rjulia<span class="op">::</span><span class="kw">julia_init</span>()
rjulia<span class="op">::</span><span class="kw">julia_void_eval</span>(<span class="st">&quot;</span>
<span class="st">using SimJulia, Distributions</span>

<span class="st">function test_mm1(n::Float64)</span>
<span class="st">  function exp_source(env::Environment, lambd::Float64,</span>
<span class="st">                      server::Resource, mu::Float64)</span>
<span class="st">    while true</span>
<span class="st">      dt = rand(Exponential(1/lambd))</span>
<span class="st">      yield(Timeout(env, dt))</span>
<span class="st">      Process(env, customer, server, mu)</span>
<span class="st">    end</span>
<span class="st">  end</span>

<span class="st">  function customer(env::Environment, server::Resource, mu::Float64)</span>
<span class="st">    yield(Request(server))</span>
<span class="st">    dt = rand(Exponential(1/mu))</span>
<span class="st">    yield(Timeout(env, dt))</span>
<span class="st">    yield(Release(server))</span>
<span class="st">  end</span>

<span class="st">  env = Environment()</span>
<span class="st">  server = Resource(env, 1)</span>
<span class="st">  Process(env, exp_source, 1.0, server, 1.1)</span>
<span class="st">  run(env, n)</span>
<span class="st">end</span>

<span class="st">function benchmark(n::Float64, times::Int)</span>
<span class="st">  results = Float64[]</span>
<span class="st">  test_mm1(n)</span>
<span class="st">  for i = 1:times</span>
<span class="st">    push!(results, @elapsed test_mm1(n))</span>
<span class="st">  end</span>
<span class="st">  return(results)</span>
<span class="st">end</span>
<span class="st">&quot;</span>)</code></pre></div>
<p>It can be noted that in both cases there is no monitoring involved, because either <code>SimPy</code> nor <code>SimJulia</code> provide automatic monitoring as <code>simmer</code> does. Furthermore, the resulting code for <code>simmer</code> is more concise and expressive than the equivalent ones for <code>SimPy</code> and <code>SimJulia</code>, which are very similar.</p>
<p>We obtain the reference benchmark with <code>n=1e4</code> and 20 replicas for both packages as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span>1e4L
times &lt;-<span class="st"> </span><span class="dv">20</span>

ref &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">SimPy =</span> rPython<span class="op">::</span><span class="kw">python.call</span>(<span class="st">&quot;benchmark&quot;</span>, n, times),
  <span class="dt">SimJulia =</span> rjulia<span class="op">::</span><span class="kw">j2r</span>(<span class="kw">paste0</span>(<span class="st">&quot;benchmark(&quot;</span>, n, <span class="st">&quot;.0, &quot;</span>, times, <span class="st">&quot;)&quot;</span>))
)</code></pre></div>
<p>As a matter of fact, we also tested a small DES skeleton in pure R provided in <span class="citation">Matloff (<a href="#ref-Matloff:2011:ARP:2090080">2011</a> s. 7.8.3)</span>. This code was formalised into an R package called <code>DES</code>, available on GitHub<a href="#fn60" class="footnoteRef" id="fnref60"><sup>60</sup></a> since 2014. The original code implemented the event queue as an ordered vector which was updated by performing a binary search. Thus, the execution time of this version was two orders of magnitude slower than the other frameworks. The most recent version on GitHub (as of 2017) takes another clever approach though: it supposes that the event vector will be short and approximately ordered; therefore, the event vector is not sorted anymore, and the next event is found using a simple linear search. These assumptions hold for many cases, and particularly for this M/M/1 scenario. As a result, the performance of this model is only <span class="math inline">\(\sim2.2\)</span> times slower than <code>SimPy</code>. Still, it is clear that pure R cannot compete with other languages in discrete-event simulation, and <code>DES</code> is not considered in our comparisons hereafter.</p>
<p>Finally, we set a benchmark for <code>simmer</code> using the <code>microbenchmark</code> package <span class="citation">(Mersmann <a href="#ref-CRAN:microbenchmark">2015</a>)</span>, again with <code>n=1e4</code> and 20 replicas for each test. Figure <a href="performance-evaluation-of-simmer.html#fig:performance-mm1">C.1</a> (left) shows the output of this benchmark. <code>simmer</code> is tested both in monitored and in non-monitored mode. The results show that the performance of <code>simmer</code> is equivalent to <code>SimPy</code> and <code>SimJulia</code>. The non-monitored <code>simmer</code> shows a slightly better performance than these frameworks, while the monitored <code>simmer</code> shows a slightly worse performance.</p>

<div class="figure" style="text-align: center"><span id="fig:performance-mm1"></span>
<img src="12-appendix-simmer-eval_files/figure-html/performance-mm1-1.png" alt="Performance comparison. Boxplots for 20 runs of the M/M/1 test with n=1e4 (left). Performance evolution with the batch size \(m\) (right)." width="49%" /><img src="12-appendix-simmer-eval_files/figure-html/performance-mm1-2.png" alt="Performance comparison. Boxplots for 20 runs of the M/M/1 test with n=1e4 (left). Performance evolution with the batch size \(m\) (right)." width="49%" />
<p class="caption">
Figure C.1: Performance comparison. Boxplots for 20 runs of the M/M/1 test with <code>n=1e4</code> (left). Performance evolution with the batch size <span class="math inline">\(m\)</span> (right).
</p>
</div>
<p>At this point, it is worth highlighting <code>simmer</code>’s ability to generate arrivals in batches (hence parameter <span class="math inline">\(m\)</span>). To better understand the impact of batched arrival generation, the benchmark was repeated over a range of <span class="math inline">\(m\)</span> values <span class="math inline">\((1, \ldots, 100)\)</span>. The results of the batched arrival generation runs are shown in Figure <a href="performance-evaluation-of-simmer.html#fig:performance-mm1">C.1</a> (right). This plot depicts the average execution time of the <code>simmer</code> model with (red) and without (blue) monitoring as a function of the generator batch size <span class="math inline">\(m\)</span>. The black dashed line sets the average execution time of the <code>SimPy</code> model to serve as a reference.</p>
<p>The performance with <code>m=1</code> corresponds to what has been shown in Figure <a href="performance-evaluation-of-simmer.html#fig:performance-mm1">C.1</a> (left). But as <span class="math inline">\(m\)</span> increases, <code>simmer</code> performance quickly improves and becomes <span class="math inline">\(\sim1.6\)</span> to <span class="math inline">\(1.9\)</span> times faster than <code>SimPy</code>. Surprisingly, there is no additional gain with batches greater than 40-50 arrivals at a time, but there is no penalty either with bigger batches. Therefore, it is always recommended to generate arrivals in big batches whenever possible.</p>
</div>
<div id="the-cost-of-calling-r-from-c" class="section level2">
<h2><span class="header-section-number">C.2</span> The Cost of Calling R from C++</h2>
<p>The C++ simulation core provided by <code>simmer</code> is quite fast, as we have demonstrated, but performance is adversely affected by numerous calls to R. The practice of calling R from C++ is generally strongly discouraged due to the overhead involved. However, in the case of <code>simmer</code>, it not only makes sense, but is even fundamental in order to provide the user with enough flexibility to build all kinds of simulation models. Nevertheless, this cost must be known, and taken into account whenever a higher performance is needed.</p>
<p>To explore the cost of calling R from C++, let us define the following test:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;simmer&quot;</span>)

test_simmer &lt;-<span class="st"> </span><span class="cf">function</span>(n, delay) {
  test &lt;-<span class="st"> </span><span class="kw">trajectory</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">timeout</span>(delay)

  env &lt;-<span class="st"> </span><span class="kw">simmer</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add_generator</span>(<span class="st">&quot;test&quot;</span>, test, <span class="kw">at</span>(<span class="dv">1</span><span class="op">:</span>n)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">run</span>(<span class="ot">Inf</span>)

  arrivals &lt;-<span class="st"> </span><span class="kw">get_mon_arrivals</span>(env)
}</code></pre></div>
<p>This toy example performs a very simple simulation in which <code>n</code> arrivals are attached (in one shot, thanks to the convenience function <code>at()</code>) to a <code>test</code> trajectory at <span class="math inline">\(t=1, 2, ..., n\)</span>. The trajectory consists of a single activity: a timeout with some configurable <code>delay</code> that may be a fixed value or a function call. Finally, after the simulation, the monitored data is extracted from the simulation core to R. Effectively, this is equivalent to generating a data frame of <code>n</code> rows (see the example output in Table <a href="performance-evaluation-of-simmer.html#tab:test-simmer-output-table">C.1</a>).</p>

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:test-simmer-output-table">Table C.1: </span>Output from the <code>test_simmer()</code> function.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Name
</th>
<th style="text-align:right;">
Start time
</th>
<th style="text-align:right;">
End time
</th>
<th style="text-align:right;">
Activity time
</th>
<th style="text-align:right;">
Finished
</th>
<th style="text-align:right;">
Replication
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
test0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
TRUE
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
test1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
TRUE
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
test2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
TRUE
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>As a matter of comparison, the following <code>test_R_for()</code> function produces the very same data using base R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_R_for &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  name &lt;-<span class="st"> </span><span class="kw">character</span>(n)
  start_time &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)
  end_time &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)
  activity_time &lt;-<span class="st"> </span><span class="kw">logical</span>(n)
  finished &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)

  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {
    name[i] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;test&quot;</span>, i<span class="op">-</span><span class="dv">1</span>)
    start_time[i] &lt;-<span class="st"> </span>i
    end_time[i] &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span>
    activity_time[i] &lt;-<span class="st"> </span><span class="dv">1</span>
    finished[i] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
  }

  arrivals &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">name=</span>name,
    <span class="dt">start_time=</span>start_time,
    <span class="dt">end_time=</span>end_time,
    <span class="dt">activity_time=</span>activity_time,
    <span class="dt">finished=</span>finished,
    <span class="dt">replication =</span> <span class="dv">1</span>
  )
}</code></pre></div>
<p>Note that we are using a <code>for</code> loop to mimic the behaviour of <code>simmer</code>’s internals, of how monitoring is made, but we concede the advantage of pre-allocated vectors to R. A second base R implementation, which builts upon the <code>lapply()</code> function, is implemented as the <code>test_R_lapply()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_R_lapply &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  <span class="kw">as.data.frame</span>(<span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="cf">function</span>(i) {
    <span class="kw">list</span>(
      <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">&quot;test&quot;</span>, i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>),
      <span class="dt">start_time =</span> i,
      <span class="dt">end_time =</span> i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,
      <span class="dt">activity_time =</span> <span class="dv">1</span>,
      <span class="dt">finished =</span> <span class="ot">TRUE</span>,
      <span class="dt">replication =</span> <span class="dv">1</span>
    )
  })))
}</code></pre></div>
<p>The <code>test_simmer()</code>, <code>test_R_for()</code> and <code>test_R_lapply()</code> functions all produce exactly the same data in a similar manner (cfr. Table <a href="performance-evaluation-of-simmer.html#tab:test-simmer-output-table">C.1</a>). Now, we want to compare how a delay consisting of a function call instead of a fixed value impacts the performance of <code>simmer</code>, and we use <code>test_R_for()</code> and <code>test_R_lapply()</code> as yardsticks.</p>
<p>The benchmark was executed with <code>n=1e5</code> and 20 replicas for each test. Table <a href="performance-evaluation-of-simmer.html#tab:performance-table">C.2</a> shows a summary of the resulting timings.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:performance-table">Table C.2: </span>Execution time (milliseconds).
</caption>
<thead>
<tr>
<th style="text-align:right;">
Expr
</th>
<th style="text-align:right;">
Min
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
Max
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;font-family: monospace;">
test_simmer(n, 1)
</td>
<td style="text-align:right;">
429.8663
</td>
<td style="text-align:right;">
492.365
</td>
<td style="text-align:right;">
480.5408
</td>
<td style="text-align:right;">
599.3547
</td>
</tr>
<tr>
<td style="text-align:right;font-family: monospace;">
test_simmer(n, function() 1)
</td>
<td style="text-align:right;">
3067.9957
</td>
<td style="text-align:right;">
3176.963
</td>
<td style="text-align:right;">
3165.6859
</td>
<td style="text-align:right;">
3434.7979
</td>
</tr>
<tr>
<td style="text-align:right;font-family: monospace;">
test_R_for(n)
</td>
<td style="text-align:right;">
2053.0840
</td>
<td style="text-align:right;">
2176.164
</td>
<td style="text-align:right;">
2102.5848
</td>
<td style="text-align:right;">
2438.6836
</td>
</tr>
<tr>
<td style="text-align:right;font-family: monospace;">
test_R_lapply(n)
</td>
<td style="text-align:right;">
1525.6682
</td>
<td style="text-align:right;">
1754.028
</td>
<td style="text-align:right;">
1757.7566
</td>
<td style="text-align:right;">
2002.6634
</td>
</tr>
</tbody>
</table>
<p>As we can see, <code>simmer</code> is <span class="math inline">\(\sim4.4\)</span> times faster than <code>for</code>-based base R and <span class="math inline">\(\sim3.6\)</span> times faster than <code>lapply</code>-based base R on average when we set a fixed delay. On the ther hand, if we replace it for a function call, the execution becomes <span class="math inline">\(\sim6.5\)</span> times slower, or <span class="math inline">\(\sim1.5\)</span> times slower than <code>for</code>-based base R. It is indeed a quite good result if we take into account the fact that base R pre-allocates memory, and that <code>simmer</code> is doing a lot more internally. But still, these results highlight the overheads involved and encourage the use of fixed values instead of function calls whenever possible.</p>

<p></p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-SimPy">
<p>Team SimPy. 2017. <em>SimPy: Discrete-Event Simulation for Python</em>. <a href="https://simpy.readthedocs.io/en/latest/" class="uri">https://simpy.readthedocs.io/en/latest/</a>.</p>
</div>
<div id="ref-GitHub:SimJulia">
<p>Lauwens, Ben. 2017. <em>SimJulia.jl: Combined Continuous-Time / Discrete-Event Process Oriented Simulation Framework Written in Julia</em>. <a href="https://github.com/BenLauwens/SimJulia.jl" class="uri">https://github.com/BenLauwens/SimJulia.jl</a>.</p>
</div>
<div id="ref-CRAN:rPython">
<p>Bellosta, Carlos J. Gil. 2015. <em>RPython: Package Allowing R to Call Python</em>. <a href="https://CRAN.R-project.org/package=rPython" class="uri">https://CRAN.R-project.org/package=rPython</a>.</p>
</div>
<div id="ref-GitHub:rJulia">
<p>Gong, Yu, Oliver Keys, and Martin Maechler. 2017. <em>Rjulia: Integrating R and Julia – Calling Julia from R</em>. <a href="https://github.com/armgong/rjulia" class="uri">https://github.com/armgong/rjulia</a>.</p>
</div>
<div id="ref-Matloff:2011:ARP:2090080">
<p>Matloff, Norman. 2011. <em>The Art of R Programming: A Tour of Statistical Software Design</em>. 1st ed. San Francisco, CA, USA: No Starch Press.</p>
</div>
<div id="ref-CRAN:microbenchmark">
<p>Mersmann, Olaf. 2015. <em>Microbenchmark: Accurate Timing Functions</em>. <a href="https://CRAN.R-project.org/package=microbenchmark" class="uri">https://CRAN.R-project.org/package=microbenchmark</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="60">
<li id="fn60"><p><a href="https://github.com/matloff/des" class="uri">https://github.com/matloff/des</a><a href="performance-evaluation-of-simmer.html#fnref60">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="experimental-validation-of-ra-tpc-inefficiencies.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["thesis.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
